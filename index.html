<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å·ç åˆ†æå·¥å…· - æ‰‹æœºç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 0; }
        .container { max-width: 100%; margin: 0 auto; background: white; min-height: 100vh; }
        .header { background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%); color: white; padding: 20px 15px; text-align: center; position: sticky; top: 0; z-index: 100; }
        .header h1 { font-size: 1.4em; margin-bottom: 5px; font-weight: 600; }
        .header p { opacity: 0.9; font-size: 0.9em; }
        .input-section { padding: 20px 15px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; }
        .input-box { background: white; border: 2px solid #3498db; border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .input-box h3 { color: #2c3e50; margin-bottom: 12px; font-size: 1.1em; display: flex; align-items: center; gap: 8px; }
        textarea { width: 100%; height: 120px; padding: 12px; border: 1px solid #e9ecef; border-radius: 8px; font-family: monospace; font-size: 16px; resize: none; background: #fafafa; }
        textarea:focus { border-color: #3498db; outline: none; background: white; }
        .format-tips { background: #e3f2fd; border: 1px solid #bbdefb; border-radius: 8px; padding: 12px; margin-top: 10px; font-size: 0.85em; color: #1565c0; }
        .format-tips ul { margin-left: 20px; margin-top: 5px; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn { padding: 14px 20px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; min-height: 50px; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; }
        .btn-success { background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white; }
        .btn-info { background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); color: white; }
        .content-tabs { display: flex; background: #f8f9fa; border-bottom: 1px solid #e9ecef; position: sticky; top: 0; z-index: 90; }
        .tab { flex: 1; padding: 15px; text-align: center; background: none; border: none; font-size: 14px; font-weight: 600; color: #6c757d; border-bottom: 3px solid transparent; transition: all 0.3s ease; }
        .tab.active { color: #3498db; border-bottom-color: #3498db; background: white; }
        .tab-content { display: none; padding: 15px; max-height: 60vh; overflow-y: auto; }
        .tab-content.active { display: block; }
        .groups-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .groups-header h2 { color: #2c3e50; margin: 0; }
        .filter-info { background: #e3f2fd; border: 1px solid #bbdefb; border-radius: 8px; padding: 8px 12px; font-size: 0.85em; color: #1565c0; }
        .groups-container { display: grid; gap: 10px; }
        .group-item { background: white; border: 1px solid #e9ecef; border-radius: 10px; padding: 15px; display: flex; align-items: center; gap: 12px; transition: all 0.3s ease; }
        .group-item.highlight { background: #fff3cd; border-color: #ffeaa7; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { background: #fff3cd; } 50% { background: #ffeaa7; } 100% { background: #fff3cd; } }
        .group-item:active { background: #f8f9fa; }
        .group-number { background: #3498db; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; font-size: 14px; }
        .group-numbers { display: flex; gap: 6px; flex-wrap: wrap; flex: 1; }
        .number { background: #ecf0f1; padding: 8px 10px; border-radius: 6px; font-weight: bold; min-width: 32px; text-align: center; font-size: 14px; transition: all 0.3s ease; }
        .number.highlight { background: #e74c3c; color: white; transform: scale(1.1); box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3); }
        .number.highlight.level-2 { background: #3498db; box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3); }
        .number.highlight.level-3 { background: #e67e22; box-shadow: 0 2px 8px rgba(230, 126, 34, 0.3); }
        .number.highlight.level-4 { background: #e74c3c; box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3); }
        .number.highlight.level-5 { background: #c0392b; box-shadow: 0 2px 8px rgba(192, 57, 43, 0.3); }
        .analysis-results { display: flex; flex-direction: column; gap: 15px; }
        .summary-cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }
        .summary-card { background: white; border-radius: 12px; padding: 15px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-left: 4px solid #3498db; }
        .summary-card.highlight { border-left-color: #e74c3c; background: linear-gradient(135deg, #fff, #ffeaa7); }
        .summary-number { font-size: 1.8em; font-weight: bold; color: #2c3e50; margin-bottom: 5px; }
        .summary-label { font-size: 0.85em; color: #7f8c8d; font-weight: 600; }
        .repeat-section { background: white; border-radius: 12px; padding: 0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .section-header { background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .section-badge { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.85em; }
        .repeat-list { padding: 10px; }
        .repeat-item { padding: 12px 10px; border-bottom: 1px solid #f1f2f6; transition: all 0.3s ease; }
        .repeat-item:last-child { border-bottom: none; }
        .repeat-item:active { background: #f8f9fa; }
        .triple-info { display: flex; align-items: center; margin-bottom: 8px; }
        .triple-badge { background: #e74c3c; color: white; padding: 8px 12px; border-radius: 8px; font-weight: bold; font-size: 14px; min-width: 80px; text-align: center; margin-right: 12px; }
        .triple-badge.level-2 { background: #3498db; }
        .triple-badge.level-3 { background: #e67e22; }
        .triple-badge.level-4 { background: #e74c3c; }
        .triple-badge.level-5 { background: #c0392b; }
        .repeat-count { font-size: 13px; color: #7f8c8d; }
        .groups-action { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
        .groups-list { display: flex; flex-wrap: wrap; gap: 5px; flex: 1; }
        .group-badge { background: #ecf0f1; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .group-badge:active { background: #3498db; color: white; transform: scale(0.95); }
        .quick-view-btn { background: #27ae60; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; white-space: nowrap; margin-left: 10px; }
        .quick-view-btn:active { background: #229954; transform: scale(0.95); }
        .empty-state { text-align: center; color: #7f8c8d; padding: 40px 20px; font-style: italic; }
        .success-state { text-align: center; padding: 40px 20px; color: #27ae60; }
        .success-state .icon { font-size: 3em; margin-bottom: 15px; }
        .loading { text-align: center; padding: 40px 20px; color: #3498db; }
        .quick-actions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        .quick-btn { padding: 10px 8px; border: 1px solid #3498db; border-radius: 8px; background: white; color: #3498db; font-size: 12px; text-align: center; transition: all 0.3s ease; }
        .quick-btn:active { background: #3498db; color: white; }
        @media (max-width: 480px) {
            .btn-group { grid-template-columns: 1fr; }
            .summary-cards { grid-template-columns: repeat(2, 1fr); }
            .quick-actions { grid-template-columns: repeat(3, 1fr); }
            .groups-action { flex-direction: column; align-items: flex-start; gap: 8px; }
            .quick-view-btn { margin-left: 0; align-self: flex-end; }
        }
        input, textarea, select { font-size: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± å·ç åˆ†æå·¥å…·</h1>
            <p>ç²˜è´´å·ç ï¼Œä¸€é”®åˆ†æé‡å¤ç»„åˆ</p>
        </div>
        
        <div class="input-section">
            <div class="input-box">
                <h3>ğŸ“ ç²˜è´´å·ç æ•°æ®</h3>
                <textarea id="pasteInput" placeholder="è¯·ç²˜è´´æ‚¨çš„å·ç æ•°æ®ï¼Œä¾‹å¦‚ï¼š
3 7 12 19 28 45
5 9 14 19 33 49
2 12 19 25 28 37
8 15 22 30 41 45"></textarea>
                
                <div class="format-tips">
                    <strong>æ”¯æŒæ ¼å¼ï¼š</strong>
                    <ul>
                        <li>æ¯è¡Œ6ä¸ªæ•°å­—ï¼Œç©ºæ ¼åˆ†éš”</li>
                        <li>ä¹Ÿæ”¯æŒé€—å·ã€åˆ¶è¡¨ç¬¦åˆ†éš”</li>
                        <li>æ”¯æŒä»»æ„è¡Œæ•°ï¼ˆ20ç»„ã€100ç»„ç­‰ï¼‰</li>
                    </ul>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="analyzeNumbers()">ğŸ” å¼€å§‹åˆ†æ</button>
                <button class="btn btn-success" onclick="shareResults()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                <button class="btn btn-info" onclick="showAllGroups()">ğŸ“„ æ˜¾ç¤ºå…¨éƒ¨</button>
            </div>
            
            <div class="quick-actions">
                <button class="quick-btn" onclick="clearInput()">æ¸…ç©ºè¾“å…¥</button>
                <button class="quick-btn" onclick="fillExample()">å¡«å……ç¤ºä¾‹</button>
                <button class="quick-btn" onclick="clearHighlights()">æ¸…é™¤é«˜äº®</button>
            </div>
        </div>
        
        <div class="content-tabs">
            <button class="tab active" onclick="switchTab('groups')">å·ç ç»„</button>
            <button class="tab" onclick="switchTab('analysis')">åˆ†æç»“æœ</button>
        </div>
        
        <div id="groupsTab" class="tab-content active">
            <div class="groups-header">
                <h2>å·ç ç»„ (<span id="groupCount">0</span>ç»„)</h2>
                <div class="filter-info" id="filterInfo" style="display: none;">ä»…æ˜¾ç¤ºé‡å¤ç»„</div>
            </div>
            <div id="groupsContainer" class="groups-container">
                <div class="empty-state">è¯·åœ¨ä¸Šæ–¹ç²˜è´´å·ç æ•°æ®åç‚¹å‡»"å¼€å§‹åˆ†æ"</div>
            </div>
        </div>
        
        <div id="analysisTab" class="tab-content">
            <div id="analysisResults">
                <div class="empty-state">ç­‰å¾…åˆ†ææ•°æ®...</div>
            </div>
        </div>
    </div>

    <script>
        // Supabase é…ç½® - è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
        const SUPABASE_URL = 'https://htkuexwyhnsuzkfksbgr.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0a3VleHd5aG5zdXprZmtzYmdyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0Mzk4ODIsImV4cCI6MjA3ODAxNTg4Mn0.AJFg7H9HKSGt45ZEJ9TSkwR02s_4ikIdjilJpEYtLvM';

        let currentData = null;
        let highlightedGroups = new Set();
        let currentHighlightedTriple = null;
        let isFilteredView = false;
        let originalGroups = [];
        
        // ç”Ÿæˆç”¨æˆ·ID
        function getUserId() {
            let userId = localStorage.getItem('user_id');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('user_id', userId);
            }
            return userId;
        }

        // è‡ªåŠ¨ä¿å­˜åˆ° Supabase
        async function saveToSupabase(text, groups, analysis) {
            try {
                console.log('ğŸ”„ å¼€å§‹ä¿å­˜åˆ° Supabase...');
                console.log('ğŸ“¦ å‡†å¤‡ä¿å­˜çš„æ•°æ®:', {
                    user_id: getUserId(),
                    input_data: text,
                    analysis_result: analysis,
                    total_groups: groups.length,
                    total_matches: Object.keys(analysis).length
                });

                const response = await fetch(SUPABASE_URL + '/rest/v1/analysis_records', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_KEY,
                        'Authorization': 'Bearer ' + SUPABASE_KEY,
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        user_id: getUserId(),
                        input_data: text,
                        analysis_result: analysis,
                        total_groups: groups.length,
                        total_matches: Object.keys(analysis).length,
                        created_at: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    console.log('âœ… åˆ†æç»“æœå·²è‡ªåŠ¨ä¿å­˜åˆ°æœåŠ¡å™¨');
                    return true;
                } else {
                    const errorText = await response.text();
                    console.error('âŒ è‡ªåŠ¨ä¿å­˜å¤±è´¥:', response.status, errorText);
                    return false;
                }
                
            } catch (error) {
                console.error('âŒ è‡ªåŠ¨ä¿å­˜é”™è¯¯:', error);
                return false;
            }
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
        }
        
        // è§£æç²˜è´´çš„æ–‡æœ¬æ•°æ®
        function parsePastedData(text) {
            const lines = text.split('\n').filter(line => line.trim() !== '');
            const groups = [];
            
            for (const line of lines) {
                const numbers = line.trim().split(/[\s,]+/).map(num => {
                    const parsed = parseInt(num.trim());
                    return isNaN(parsed) ? null : parsed;
                }).filter(num => num !== null);
                
                if (numbers.length >= 6) {
                    const group = numbers.slice(0, 6).sort((a, b) => a - b);
                    groups.push(group);
                }
            }
            return groups;
        }
        
        // åˆ†æä¸‰åŒå·
        function analyzeTriples(groups) {
            const tripleMatches = new Map();
            
            for (let i = 0; i < groups.length; i++) {
                const group = groups[i];
                for (let a = 0; a < group.length - 2; a++) {
                    for (let b = a + 1; b < group.length - 1; b++) {
                        for (let c = b + 1; c < group.length; c++) {
                            const triple = [group[a], group[b], group[c]].sort((x, y) => x - y);
                            const tripleKey = triple.join(',');
                            
                            if (!tripleMatches.has(tripleKey)) {
                                tripleMatches.set(tripleKey, []);
                            }
                            if (!tripleMatches.get(tripleKey).includes(i)) {
                                tripleMatches.get(tripleKey).push(i);
                            }
                        }
                    }
                }
            }
            
            const result = {};
            for (const [tripleKey, groups] of tripleMatches) {
                if (groups.length >= 2) {
                    result[tripleKey] = { groups: groups, numbers: tripleKey.split(',').map(Number) };
                }
            }
            return result;
        }
        
        // ä¸»åˆ†æå‡½æ•° - è‡ªåŠ¨ä¿å­˜ç‰ˆæœ¬
        async function analyzeNumbers() {
            const text = document.getElementById('pasteInput').value.trim();
            if (!text) { 
                alert('è¯·å…ˆç²˜è´´å·ç æ•°æ®ï¼'); 
                return; 
            }
            
            const groups = parsePastedData(text);
            if (groups.length === 0) { 
                alert('æœªæ‰¾åˆ°æœ‰æ•ˆçš„å·ç æ•°æ®ï¼Œè¯·æ£€æŸ¥æ ¼å¼ï¼'); 
                return; 
            }
            
            document.getElementById('analysisResults').innerHTML = '<div class="loading">æ­£åœ¨åˆ†ææ•°æ®...</div>';
            
            // ä½¿ç”¨å¼‚æ­¥ç­‰å¾…ï¼Œç¡®ä¿åˆ†æå®Œæˆåå†ä¿å­˜
            setTimeout(async () => {
                const analysis = analyzeTriples(groups);
                currentData = { groups, analysis };
                originalGroups = groups;
                
                displayGroups(groups);
                displayAnalysis(groups, analysis);
                switchTab('analysis');
                
                // è‡ªåŠ¨ä¿å­˜åˆ°æœåŠ¡å™¨
                const saveSuccess = await saveToSupabase(text, groups, analysis);
                if (saveSuccess) {
                    console.log('ğŸ‰ è‡ªåŠ¨ä¿å­˜å®Œæˆï¼');
                } else {
                    console.log('âš ï¸ è‡ªåŠ¨ä¿å­˜å¤±è´¥ï¼Œä½†åˆ†æåŠŸèƒ½æ­£å¸¸');
                }
                
                if (navigator.vibrate) { 
                    navigator.vibrate(100); 
                }
            }, 100);
        }
        
        // æ˜¾ç¤ºå·ç ç»„
        function displayGroups(groups, filteredGroupIndices = null) {
            const container = document.getElementById('groupsContainer');
            const countElement = document.getElementById('groupCount');
            const filterInfo = document.getElementById('filterInfo');
            
            if (filteredGroupIndices) {
                countElement.textContent = `${filteredGroupIndices.length}/${groups.length}`;
                filterInfo.style.display = 'block';
                isFilteredView = true;
            } else {
                countElement.textContent = groups.length;
                filterInfo.style.display = 'none';
                isFilteredView = false;
            }
            
            container.innerHTML = '';
            if (groups.length === 0) {
                container.innerHTML = '<div class="empty-state">æ²¡æœ‰å·ç æ•°æ®</div>';
                return;
            }
            
            const groupsToShow = filteredGroupIndices ? 
                filteredGroupIndices.map(index => ({ group: groups[index], index })) : 
                groups.map((group, index) => ({ group, index }));
            
            groupsToShow.forEach(({ group, index }) => {
                const groupElement = document.createElement('div');
                groupElement.className = 'group-item';
                groupElement.id = `group-${index + 1}`;
                groupElement.innerHTML = `
                    <div class="group-number">${index + 1}</div>
                    <div class="group-numbers">
                        ${group.map(num => `<span class="number" data-number="${num}">${num}</span>`).join('')}
                    </div>
                `;
                container.appendChild(groupElement);
            });
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰ç»„
        function showAllGroups() {
            if (originalGroups.length > 0) { displayGroups(originalGroups); clearHighlights(); }
        }
        
        // è·³è½¬åˆ°æŒ‡å®šç»„å¹¶é«˜äº®é‡å¤å·ç 
        function jumpToGroup(groupNumber, triple, level) {
            clearHighlights();
            currentHighlightedTriple = { triple, level };
            
            const groupElement = document.getElementById(`group-${groupNumber}`);
            if (groupElement) {
                groupElement.classList.add('highlight');
                highlightedGroups.add(groupNumber);
                
                const numbers = triple.split(',').map(Number);
                const numberElements = groupElement.querySelectorAll('.number');
                numberElements.forEach(element => {
                    const num = parseInt(element.getAttribute('data-number'));
                    if (numbers.includes(num)) {
                        element.classList.add('highlight', `level-${level}`);
                    }
                });
                
                switchTab('groups');
                setTimeout(() => { groupElement.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 300);
            }
        }
        
        // ä¸€é”®æŸ¥çœ‹æ‰€æœ‰é‡å¤ç»„
        function quickViewAllGroups(triple, level, groupIndices) {
            clearHighlights();
            currentHighlightedTriple = { triple, level };
            displayGroups(originalGroups, groupIndices);
            
            groupIndices.forEach(groupIndex => {
                const groupNumber = groupIndex + 1;
                const groupElement = document.getElementById(`group-${groupNumber}`);
                if (groupElement) {
                    groupElement.classList.add('highlight');
                    highlightedGroups.add(groupNumber);
                    
                    const numbers = triple.split(',').map(Number);
                    const numberElements = groupElement.querySelectorAll('.number');
                    numberElements.forEach(element => {
                        const num = parseInt(element.getAttribute('data-number'));
                        if (numbers.includes(num)) {
                            element.classList.add('highlight', `level-${level}`);
                        }
                    });
                }
            });
            
            switchTab('groups');
            if (groupIndices.length > 0) {
                const firstGroupElement = document.getElementById(`group-${groupIndices[0] + 1}`);
                if (firstGroupElement) {
                    setTimeout(() => { firstGroupElement.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 300);
                }
            }
        }
        
        // æ¸…é™¤æ‰€æœ‰é«˜äº®
        function clearHighlights() {
            highlightedGroups.forEach(groupNumber => {
                const groupElement = document.getElementById(`group-${groupNumber}`);
                if (groupElement) {
                    groupElement.classList.remove('highlight');
                    const numberElements = groupElement.querySelectorAll('.number');
                    numberElements.forEach(element => {
                        element.classList.remove('highlight', 'level-2', 'level-3', 'level-4', 'level-5');
                    });
                }
            });
            highlightedGroups.clear();
            currentHighlightedTriple = null;
        }
        
        // æ˜¾ç¤ºåˆ†æç»“æœ
        function displayAnalysis(groups, analysis) {
            const container = document.getElementById('analysisResults');
            
            if (Object.keys(analysis).length === 0) {
                container.innerHTML = `
                    <div class="success-state">
                        <div class="icon">ğŸ‰</div>
                        <div>å¤ªæ£’äº†ï¼æ²¡æœ‰å‘ç°é‡å¤çš„ä¸‰åŒå·</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: #7f8c8d;">åˆ†æäº† ${groups.length} ç»„å·ç ï¼Œæ•°æ®åˆ†å¸ƒè‰¯å¥½</div>
                    </div>
                `;
                return;
            }
            
            const totalMatches = Object.keys(analysis).length;
            const maxRepeatLevel = Math.max(...Object.keys(analysis).map(k => analysis[k].groups.length));
            const importantMatches = Object.values(analysis).filter(data => data.groups.length >= 3).length;
            
            let html = `
                <div class="summary-cards">
                    <div class="summary-card"><div class="summary-number">${groups.length}</div><div class="summary-label">æ€»ç»„æ•°</div></div>
                    <div class="summary-card ${totalMatches > 0 ? 'highlight' : ''}"><div class="summary-number">${totalMatches}</div><div class="summary-label">é‡å¤ç»„åˆ</div></div>
                    <div class="summary-card ${maxRepeatLevel >= 3 ? 'highlight' : ''}"><div class="summary-number">${maxRepeatLevel}</div><div class="summary-label">æœ€é«˜é‡å¤</div></div>
                    <div class="summary-card ${importantMatches > 0 ? 'highlight' : ''}"><div class="summary-number">${importantMatches}</div><div class="summary-label">é‡è¦é‡å¤</div></div>
                </div>
            `;
            
            const sortedAnalysis = Object.entries(analysis).sort((a, b) => b[1].groups.length - a[1].groups.length);
            
            html += `
                <div class="repeat-section">
                    <div class="section-header"><span>æ‰€æœ‰é‡å¤ç»„åˆ</span><span class="section-badge">${totalMatches}ä¸ªç»„åˆ</span></div>
                    <div class="repeat-list">
                        ${sortedAnalysis.map(([triple, data]) => {
                            const level = Math.min(data.groups.length, 5);
                            const levelColors = { 2: 'level-2', 3: 'level-3', 4: 'level-4', 5: 'level-5' };
                            
                            return `
                                <div class="repeat-item">
                                    <div class="triple-info">
                                        <div class="triple-badge ${levelColors[level]}">${triple.split(',').join(' ')}</div>
                                        <div class="repeat-count">é‡å¤ ${data.groups.length} æ¬¡</div>
                                    </div>
                                    <div class="groups-action">
                                        <div class="groups-list">
                                            ${data.groups.map(idx => `<span class="group-badge" onclick="jumpToGroup(${idx + 1}, '${triple}', ${level})">ç»„${idx + 1}</span>`).join('')}
                                        </div>
                                        <button class="quick-view-btn" onclick="quickViewAllGroups('${triple}', ${level}, [${data.groups}])">åªçœ‹è¿™${data.groups.length}ç»„</button>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // å¤åˆ¶ç»“æœ
        function shareResults() {
            if (!currentData) { alert('è¯·å…ˆåˆ†ææ•°æ®ï¼'); return; }
            
            let shareText = `å·ç åˆ†ææŠ¥å‘Š\nåˆ†ææ—¶é—´: ${new Date().toLocaleString()}\næ€»ç»„æ•°: ${currentData.groups.length}ç»„\né‡å¤ç»„åˆ: ${Object.keys(currentData.analysis).length}ä¸ª\n\n`;
            
            const sortedAnalysis = Object.entries(currentData.analysis).sort((a, b) => b[1].groups.length - a[1].groups.length);
            sortedAnalysis.forEach(([triple, data]) => {
                const groupText = data.groups.map(g => g + 1).join(', ');
                shareText += `é‡å¤${data.groups.length}æ¬¡: ${triple}\nå‡ºç°åœ¨ç»„: ${groupText}\n\n`;
            });
            
            copyToClipboard(shareText);
            alert('åˆ†æç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                console.log('å¤åˆ¶æˆåŠŸ');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            });
        }
        
        // å¿«æ·åŠŸèƒ½
        function clearInput() { document.getElementById('pasteInput').value = ''; }
        
        function fillExample() {
            const example = `3 7 12 19 28 45
5 9 14 19 33 49
2 12 19 25 28 37
8 15 22 30 41 45
1 7 14 23 33 46
4 12 19 28 39 42
6 11 20 31 37 44
10 16 24 32 40 48`;
            document.getElementById('pasteInput').value = example;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', function() { 
            console.log('ğŸ“± æ‰‹æœºç‰ˆå·ç åˆ†æå·¥å…·å·²åŠ è½½');
            console.log('ğŸš€ è‡ªåŠ¨ä¿å­˜åŠŸèƒ½å·²å¯ç”¨ - åˆ†æå®Œæˆåè‡ªåŠ¨ä¿å­˜åˆ°æœåŠ¡å™¨');
            console.log('ğŸ”— Supabase URL:', SUPABASE_URL);
        });
    </script>
</body>
</html>

